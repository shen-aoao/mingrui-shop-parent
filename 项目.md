

### 项目搭建

#### 1.1.1创建项目  xxx-shop-parent 删除src 在pom.xml引入

<properties>

​    <!--项目构建编码-->

​    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>

​    <project.reporting.outputEncoding>UTF8</project.reporting.outputEncoding>

​    <!--声明JDK版本-->

​    <java.version>1.8</java.version>

​    <!--spring cloud 版本.注意此版本是建立在boot2.2.2版本上的-->

​    <mr.spring.cloud.version>Hoxton.SR1</mr.spring.cloud.version>

</properties>

<!--boot 版本-->

<parent>

​    <groupId>org.springframework.boot</groupId>

​    <artifactId>spring-boot-starter-parent</artifactId>

​    <version>2.3.1.RELEASE</version>

​    <!--始终从仓库中获取，不从本地路径获取-->

​    <relativePath />

</parent>

<dependencies>

​    <!-- 集成commons工具类 -->

​    <dependency>

​        <groupId>org.apache.commons</groupId>

​        <artifactId>commons-lang3</artifactId>

​    </dependency>

​    <!-- 集成lombok 框架 -->

​    <dependency>

​        <groupId>org.projectlombok</groupId>

​        <artifactId>lombok</artifactId>

​        <version>1.16.18</version>

​        <scope>provided</scope>

​    </dependency>

​    <!--junit测试-->

​    <dependency>

​        <groupId>junit</groupId>

​        <artifactId>junit</artifactId>

​    </dependency>

​    <!-- SpringBoot整合eureka客户端 -->

​    <!--boot 测试模块-->

​    <dependency>

​        <groupId>org.springframework.boot</groupId>

​        <artifactId>spring-boot-starter-test</artifactId>

​        <scope>test</scope>

​    </dependency>

</dependencies>

<!-- 项目依赖,子级模块可以继承依赖-->

<dependencyManagement>

​    <dependencies>

​        <!--cloud 依赖-->

​        <dependency>

​            <groupId>org.springframework.cloud</groupId>

​            <artifactId>spring-cloud-dependencies</artifactId>

​            <version>${mr.spring.cloud.version}</version>

​            <type>pom</type>

​            <!--解决maven单继承的问题-->

​            <scope>import</scope>

​        </dependency>

​    </dependencies>

</dependencyManagement>

<!-- 注意： 这里必须要添加， 否者各种依赖有问题 -->

<repositories>

​    <repository>

​        <id>spring-milestones</id>

​        <name>Spring Milestones</name>

​        <url>https://repo.spring.io/libs-milestone</url>

​        <snapshots>

​            <enabled>false</enabled>

​        </snapshots>

​    </repository>

</repositories>

#### 1.1.2在xxx-shop-parent项目下创建基础服务父工程xxx-shop-basics 删除src文件夹

在pom.xml文件引入

<!--父级项目不需要打包所有packging的类型为pom-->

<packaging>pom</packaging>

#### 1.1.3创建公共(工具)工程

在xxx-shop-parent下创建xxx-shop-commons

删除src文件夹

在pom.xml文件引入

<!--父级项目不需要打包所有packging的类型为pom-->

<packaging>pom</packaging>

#### 1.1.4创建服务实现工程

在xxx-shop-parent下创建xxx-shop-service

删除src文件夹

在pom.xml文件引入

<dependencies>

​    <!-- SpringBoot-整合Web组件 -->

​    <dependency>

​        <groupId>org.springframework.boot</groupId>

​        <artifactId>spring-boot-starter-web</artifactId>

​    </dependency>

​    <!-- springcloud feign组件 -->

​    <dependency>

​        <groupId>org.springframework.cloud</groupId>

​        <artifactId>spring-cloud-starter-openfeign</artifactId>

​    </dependency>

​    <!--mysql数据库连接-->

​    <dependency>

​        <groupId>mysql</groupId>

​        <artifactId>mysql-connector-java</artifactId>

​        <version>5.1.30</version>

​        <scope>runtime</scope><!--项目运行阶段使用-->

​    </dependency>

​    <!--通用mapper-->

​    <dependency>

​        <groupId>tk.mybatis</groupId>

​        <artifactId>mapper-spring-boot-starter</artifactId>

​        <version>2.1.5</version>

​    </dependency>

​    <!--分页工具

​    自定义的 mybatis 插件

​    mybatis运行原理 mybatis的执行器-->

​    <dependency>

​        <groupId>com.github.pagehelper</groupId>

​        <artifactId>pagehelper-spring-boot-starter</artifactId>

​        <version>1.2.10</version>

​    </dependency>

​    <dependency>

​        <groupId>com.baidu</groupId>

​        <artifactId>mingrui-shop-service-api-xxx</artifactId>

​        <version>1.0-SNAPSHOT</version>

​    </dependency>

</dependencies>

#### 1.1.5创建服务接口工程

在xxx-shop-parent下创建xxx-shop-service-api

删除src文件夹

在pom.xml引入

<dependencies>

​    <!-- SpringBoot-整合Web组件 -->

​    <dependency>

​        <groupId>org.springframework.boot</groupId>

​        <artifactId>spring-boot-starter-web</artifactId>

​    </dependency>

​    <!--Entity 中的@Table 和@Id需要此注解-->

​    <dependency>

​        <groupId>javax.persistence</groupId>

​        <artifactId>persistence-api</artifactId>

​        <version>1.0.2</version>

​    </dependency>

​    <!--2.3版本之后web删除了验证插件-->

​    <dependency>

​        <groupId>org.springframework.boot</groupId>

​        <artifactId>spring-boot-starter-validation</artifactId>

​    </dependency>

​    <!--引入common工程代码 把微服务的这个概念做到极致   让模块(服务) 复用-->

​    <dependency>

​        <groupId>com.baidu</groupId>

​        <artifactId>mingrui-shop-common-core</artifactId>

​        <version>1.0-SNAPSHOT</version>

​    </dependency>

​    <dependency>

​        <groupId>io.springfox</groupId>

​        <artifactId>springfox-swagger2</artifactId>

​        <version>2.9.2</version>

​    </dependency>

​    <!--提供可视化的API文档-->

​    <dependency>

​        <groupId>io.springfox</groupId>

​        <artifactId>springfox-swagger-ui</artifactId>

​        <version>2.9.2</version>

​    </dependency>

​    <dependency>

​        <groupId>com.github.pagehelper</groupId>

​        <artifactId>pagehelper-spring-boot-starter</artifactId>

​        <version>1.2.10</version>

​    </dependency>

</dependencies>

#### 1.1.6创建eureka服务

在xxx-shop-basics工程下创建>xxx-shop-basic-eureka-server

在pom.xml引入

<dependencies>

​    <!--eureka 服务依赖-->

​    <dependency>

​        <groupId>org.springframework.cloud</groupId>

​        <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>

​    </dependency>

</dependencies>

引入application.yml

server:

  port: 8761

spring:

  application:

​    name: eureka-server

eureka:

  client:

​    *# eureka**服务**url,**值为**map**集合默认**key**为**defaultZone*

​    service-url:

​      defaultZone: http://${eureka.instance.hostname}:${server.port}/eureka

​    *#* *当前服务是否同时注册*

​    register-with-eureka: false

​    *#* *去注册中心获取其他服务的地址*

​    fetch-registry: false

  instance:

​    hostname: localhost

​    *#* *定义服务续约任务（心跳）的调用间隔，单位：秒 默认**30*

​    lease-renewal-interval-in-seconds: 1

​    *#* *定义服务失效的时间，单位：秒 默认**90*

​    lease-expiration-duration-in-seconds: 2

  server:

​    *#* *测试时关闭自我保护机制，保证不可用服务及时踢出*

​    enable-self-preservation: false

启动类

package com.baidu.shop;

import org.springframework.boot.SpringApplication;

import org.springframework.boot.autoconfigure.SpringBootApplication;

import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

*/***

 *** **@ClassName** *RunEurekaServerApplication*

 *** **@Description:** *TODO*

 *** **@Author** *shenao*

 *** **@Date** *2020/12/23*

 *** **@Version** *V1.0*

 ***/*

@SpringBootApplication

@EnableEurekaServer

public class RunEurekaServerApplication {

​    public static void main(String[] args) {

​        SpringApplication.*run*(RunEurekaServerApplication.class);

​    }

}

#### 2.1使用域名访问本地项目

2.1.1一个域名一定会被解析为一个或多个ip。这一般会包含两步： 本地域名解析 浏览器会首先在本机的hosts文件中查找域名映射的IP地址，如果查找到就返回IP ，没找到则进行 域名服务器解析，一般本地解析都会失败，因为默认这个文件是空的。 Windows下的hosts文件地址：C:/Windows/System32/drivers/etc/hosts Linux下的hosts文件所在路径： /etc/hosts 

样式： # My hosts 

​            127.0.0.1 localhost 

​             0.0.0.0 account.jetbrains.com 

​             127.0.0.1 [www.xmind.net](http://www.xmind.net)

解决域名解析问题

127.0.0.1 api.mrshop.com 

127.0.0.1 manage.mrshop.com

这样就实现了域名的关系映射了。

注意:有可能出现不能修改文件的问题 1:用户权限的问题 2:文件有只读属性 

添加了两个映射关系： 127.0.0.1 api.mrshop.com ：我们的网关Zuul 

​                                     127.0.0.1 manage.shop.com：我们的后台系统地址

现在，ping一下域名试试是否畅通：

启动项目 输入

![img](D:\qqE0715F285C245575ECBB57D21B2EA720\408977f9cde747ad9fd77470bd948a5a\clipboard.png)

输入域名 + 9001端口号出现上述错误 

打开build文件夹下webpack.dev.conf.js文件在devServer下加入

disableHostCheck: true,

![img](D:\qqE0715F285C245575ECBB57D21B2EA720\f7aafff97ee446679e7d2623283f13c2\clipboard.png)

#### 2.2 nginx解决端口问题 

我们希望的是直接域名访问： http://manage.mrshop.com 。这种情况下端口默认是80，如何才能把 请求转移到9001端口呢？ 这里就要用到反向代理工具：Nginx

修改nginx/conf/nginx.conf文件

nginx可以通过命令行来启动，操作命令： 启动： start nginx.exe 

​                                                                    停止： nginx.exe -s stop 

   重新加载： nginx.exe -s reload

worker_processes  1;

events {

​    worker_connections  1024;

}

http {

​    include       mime.types;

​    default_type  application/octet-stream;

  

​    sendfile        on;

  

​    server {

​        listen 80;

​		server_name manage.mrshop.com;

​		proxy_set_header X-Forwarded-Host $host;

​		proxy_set_header X-Forwarded-Server $host;

​		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

​        location / {

​            proxy_pass http://127.0.0.1:9001;

​			proxy_connect_timeout 600;

​			proxy_read_timeout 600;

​        }

​       

​    }

​	

​	server {

​			listen 80;

​			server_name api.mrshop.com;

​			

​			proxy_set_header X-Forwarded-Host $host;

​			proxy_set_header X-Forwarded-Server $host;

​			proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

​			

​			location / {

​			proxy_pass http://127.0.0.1:8088;

​			proxy_connect_timeout 600;

​			proxy_read_timeout 600;

​			}

​			

​			# 上传路径的映射

​			# 只要包含/api-xxx/upload 都会把请求映射到8200服务

​			# rewrite "^/api-xxx/(.*)$" /$1 break;

​			# 将/api-xxx 替换成/

​			location /api-xxx/upload {

​				proxy_pass http://127.0.0.1:8200;

​				proxy_connect_timeout 600;

​				proxy_read_timeout 600;

​				rewrite "^/api-xxx/(.*)$" /$1 break;

​			}

​		}

​		

​	server {

​		listen 80;

​		server_name image.mrshop.com;

​		proxy_set_header X-Forwarded-Host $host;

​		proxy_set_header X-Forwarded-Server $host;

​		proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

​		location ~ .*\.(gif|jpg|pdf|jpeg|png)$

​		{

​	

​		root D:\images;

​		}

​		location / {

​		root html;

​		index index.html index.htm;

​		}

​	}

}

2.5测试

浏览器输入http://manage.mrshop.com/

![img](D:\qqE0715F285C245575ECBB57D21B2EA720\6b5af349c29845b29d612022e95e9469\clipboard.png)

#### 3 商品分类管理(查询)

3.1 mingrui-shop-common-core工程 

3.1.1 在mingrui-shop--commons项目下新建mingrui-shopcommon-core项目

在pom.xml引入

<dependencies>

​    <!--处理json与各种数据类型或文档类型的转换-->

​    <dependency>

​        <groupId>com.google.code.gson</groupId>

​        <artifactId>gson</artifactId>

​        <version>2.8.5</version>

​    </dependency>

​    <!--json对象序列化和反序列化的支持-->

​    <dependency>

​        <groupId>org.codehaus.jackson</groupId>

​        <artifactId>jackson-core-lgpl</artifactId>

​        <version>1.9.13</version>

​    </dependency>

​    <dependency>

​        <groupId>org.codehaus.jackson</groupId>

​        <artifactId>jackson-mapper-lgpl</artifactId>

​        <version>1.9.13</version>

​    </dependency>

​    <!--java对象和json对象之间的转换-->

​    <dependency>

​        <groupId>org.codehaus.jackson</groupId>

​        <artifactId>jackson-core-asl</artifactId>

​        <version>1.9.13</version>

​    </dependency>

​    <dependency>

​        <groupId>org.codehaus.jackson</groupId>

​        <artifactId>jackson-mapper-asl</artifactId>

​        <version>1.9.13</version>

​    </dependency>

​    <!--alibaba的json处理工具-->

​    <dependency>

​        <groupId>com.alibaba</groupId>

​        <artifactId>fastjson</artifactId>

​        <version>1.2.62</version>

​    </dependency>

​    <dependency>

​        <groupId>com.fasterxml.jackson.core</groupId>

​        <artifactId>jackson-databind</artifactId>

​        <version>2.11.2</version>

​    </dependency>

​    <dependency>

​        <groupId>org.springframework</groupId>

​        <artifactId>spring-context</artifactId>

​    </dependency>

​    <dependency>

​    <groupId>org.slf4j</groupId>

​    <artifactId>slf4j-api</artifactId>

​    <version>1.6.1</version>

​    </dependency>

​    <dependency>

​        <groupId>org.springframework.boot</groupId>

​        <artifactId>spring-boot-starter-web</artifactId>

​    </dependency>

​    <dependency>

​        <groupId>io.springfox</groupId>

​        <artifactId>springfox-swagger2</artifactId>

​        <version>2.9.2</version>

​    </dependency>

​    <dependency>

​        <groupId>com.belerweb</groupId>

​        <artifactId>pinyin4j</artifactId>

​        <version>2.5.1</version>

​    </dependency>

</dependencies>

3.1.3 新建包com.baidu.shop.utils

3.1.4 JSONUtil

package com.baidu.shop.utils;

import com.alibaba.fastjson.JSONObject;

import org.codehaus.jackson.JsonParseException;

import org.codehaus.jackson.map.JsonMappingException;

import org.codehaus.jackson.map.ObjectMapper;

import org.codehaus.jackson.type.TypeReference;

import com.google.gson.Gson;

import com.google.gson.GsonBuilder;

import com.google.gson.JsonArray;

import com.google.gson.JsonElement;

import com.google.gson.JsonObject;

import com.google.gson.JsonParser;

import com.google.gson.reflect.TypeToken;

import java.io.FileOutputStream;

import java.io.IOException;

import java.util.ArrayList;

import java.util.HashMap;

import java.util.List;

import java.util.Map;

*/***

 *** **@ClassName** *JsonUtil*

 *** **@Description:** *TODO*

 *** **@Author** *shenao*

 *** **@Date** *2020/12/22*

 *** **@Version** *V1.0*

 ***/*

public class JSONUtil {

​    private static Gson *gson* = null;

​    static {

​        *gson* = new GsonBuilder().setDateFormat("yyyy-MM-dd HH:mm:ss").create();// *todo yyyy-MM-dd HH:mm:ss*

​    }

​    public static synchronized Gson newInstance() {

​        if (*gson* == null) {

​            *gson* = new GsonBuilder().setDateFormat("yyyy-MM-dd HH:mm:ss").create();

​        }

​        return *gson*;

​    }

​    public static String toJsonString(Object obj) {

​        return *gson*.toJson(obj);

​    }

​    public static <T> T toBean(String json, Class<T> clz) {

​        return *gson*.fromJson(json, clz);

​    }

​    public static <T> Map<String, T> toMap(String json, Class<T> clz) {

​        Map<String, JsonObject> map = *gson*.fromJson(json, new

​                TypeToken<Map<String, JsonObject>>() {

​                }.getType());

​        Map<String, T> result = new HashMap<String, T>();

​        for (String key : map.keySet()) {

​            result.put(key, *gson*.fromJson(map.get(key), clz));

​        }

​        return result;

​    }

​    public static Map<String, Object> toMap(String json) {

​        Map<String, Object> map = *gson*.fromJson(json, new TypeToken<Map<String,

​                Object>>() {

​        }.getType());

​        return map;

​    }

​    public static <T> List<T> toList(String json, Class<T> clz) {

​        JsonArray array = new JsonParser().parse(json).getAsJsonArray();

​        List<T> list = new ArrayList<T>();

​        for (final JsonElement elem : array) {

​            list.add(*gson*.fromJson(elem, clz));

​        }

​        return list;

​    }

​    */***

​     *** *从**json**字符串中获取需要的值*

​     ***

​     *** **@param** *json*

​     *** **@param** *clazz* *要转换的类型*

​     *** **@return**

​     **/*

​    public static <T> Object getObjectByKey(String json, Class<T> clazz) {

​        if (json != null && !"".equals(json)) {

​            return JSONObject.*parseObject*(json, clazz);

​        }

​        return null;

​    }

​    */***

​     *** *从**json**字符串中获取需要的值*

​     ***

​     *** **@param** *json*

​     *** **@param** *clazz* *要转换的类型*

​     *** **@return**

​     **/*

​    public static <T> List<T> getListByKey(String json, Class<T> clazz) {

​        if (json != null && !"".equals(json)) {

​            return JSONObject.*parseArray*(json, clazz);

​        }

​        return null;

​    }

​    */***

​     *** *从**json**字符串中获取需要的值*

​     ***

​     *** **@param** *json*

​     *** **@param** *key*

​     *** *键*

​     *** **@return**

​     **/*

​    public static String getStrByKey(String json, String key) {

​        String str = "";

​        if (json != null && !"".equals(json)) {

​            JSONObject j = JSONObject.*parseObject*(json);

​            if (j.get(key) != null) {

​                str = j.get(key).toString();

​            }

​        }

​        return str;

​    }

​    */***

​     *** *向文件中写数据*

​     ***

​     *** **@param** *_sDestFile*

​     *** **@param** *_sContent*

​     *** **@throws** *IOException*

​     **/*

​    public static void writeByFileOutputStream(String _sDestFile, String

​            _sContent) throws IOException {

​        FileOutputStream fos = null;

​        try {

​            fos = new FileOutputStream(_sDestFile);

​            fos.write(_sContent.getBytes());

​        } catch (Exception ex) {

​            ex.printStackTrace();

​        } finally {

​            if (fos != null) {

​                fos.close();

​                fos = null;

​            }

​        }

​    }

​    */***

​     *** *非空*

​     ***

​     *** **@param** *str*

​     *** **@return** *true:**不为空* *false**：空*

​     **/*

​    public static boolean noEmpty(String str) {

​        boolean flag = true;

​        if ("".equals(str)) {

​            flag = false;

​        }

​        return flag;

​    }

​    */***

​     *** *将**"%"**去掉*

​     ***

​     *** **@param** *str*

​     *** **@return**

​     **/*

​    public static double getDecimalByPercentage(String str) {

​        double fuse = 0.0;

​        if (!"".equals(str) && str != null) {

​            if (str.split("%").length > 0) {

​                fuse = Double.*parseDouble*(str.split("%")[0]);

​                return fuse;

​            }

​        }

​        return 0.0;

​    }

​    */***

​     *** *保留**2**位小数*

​     ***

​     *** **@param** *number*

​     *** **@return**

​     **/*

​    public static double ConversionFraction(double number) {

​        return Math.*floor*(number * 100 + 0.5) / 100;

​    }

​    public static float ConversionM(double number) {

​        return (float) JSONUtil.*ConversionFraction*(number / 1024 / 1024);

​    }

​    public static String getErrorText(String s) {

​        JSONObject j = JSONObject.*parseObject*(s);

​        return

​                j.getJSONObject(j.keySet().iterator().next()).get("errortext").toString();

​    }

​    public static String getSingleJobId(String s) throws Exception {

​        JSONObject j = JSONObject.*parseObject*(s);

​        try {

​            return

​                    j.getJSONObject(j.keySet().iterator().next()).get("jobid").toString();

​        } catch (Exception e) {

​            try {

​                return

​                        j.getJSONObject(j.keySet().iterator().next()).get("errortext").toString();

​            } catch (Exception e1) {

​                throw new Exception(e1.getMessage());

​            }

​        }

​    }

​    public static <T> T readValue(String jsonStr, TypeReference type)

​            throws JsonParseException, JsonMappingException, IOException {

​        ObjectMapper mapper = new ObjectMapper();

​        return mapper.readValue(jsonStr, type);

​    }

​    public static JSON_TYPE getJSONType(String str) {

​        if (null == str || "".equals(str)) {

​            return JSON_TYPE.*JSON_TYPE_ERROR*;

​        }

​        final char[] strChar = str.substring(0, 1).toCharArray();

​        final char firstChar = strChar[0];

​        if (firstChar == '{') {

​            return JSON_TYPE.*JSON_TYPE_OBJECT*;

​        } else if (firstChar == '[') {

​            return JSON_TYPE.*JSON_TYPE_ARRAY*;

​        } else {

​            return JSON_TYPE.*JSON_TYPE_ERROR*;

​        }

​    }

​    public enum JSON_TYPE {

​        */** JSONObject \*/*

​        *JSON_TYPE_OBJECT*,

​        */** JSONArray \*/*

​        *JSON_TYPE_ARRAY*,

​        */*** *不是**JSON**格式的字符串* **/*

​        *JSON_TYPE_ERROR*

​    }

}

3.1.5 新建包com.baidu.shop.status

3.1.6 HTTPStatus

package com.baidu.shop.status;

*/***

 *** **@ClassName** *HTTPStatus*

 *** **@Description:** *TODO*

 *** **@Author** *shenao*

 *** **@Date** *2020/12/22*

 *** **@Version** *V1.0*

 ***/*

public class HTTPStatus {

​    public static final  int *OK* = 200;//成功

​    public static final int *ERROR* = 500;//失败

​    public static final int *OPERATION_ERROR* = 5001;//操作失败

​    public static final int *PARAMS_VALIDATE_ERROR* = 5002;//參數效驗失敗

}

3.1.7 新建包com.baidu.shop.base

3.1.8 Result

package com.baidu.shop.base;

import lombok.Data;

import lombok.NoArgsConstructor;

*/***

 *** **@ClassName** *Result*

 *** **@Description:** *TODO*

 *** **@Author** *shenao*

 *** **@Date** *2020/12/22*

 *** **@Version** *V1.0*

 ***/*

@Data

@NoArgsConstructor

public class Result<T> {

​    private Integer code;//返回码

​    private String message;//返回消息

​    private T data;//返回数据

​    public Result(Integer code, String message, Object data) {

​        this.code = code;

​        this.message = message;

​        this.data = (T) data;

​    }

}

BaseApiService

package com.baidu.shop.base;

import com.baidu.shop.status.HTTPStatus;

import com.baidu.shop.utils.JSONUtil;

import lombok.Data;

import lombok.extern.slf4j.Slf4j;

import org.springframework.stereotype.Component;

*/***

 *** **@ClassName** *BaseApiService*

 *** **@Description:** *TODO*

 *** **@Author** *shenao*

 *** **@Date** *2020/12/22*

 *** **@Version** *V1.0*

 ***/*

@Data

@Component

@Slf4j

public class BaseApiService<T> {

​    public Result<T> setResultError(Integer code, String msg) {

​        return setResult(code, msg, null);

​    }

​    // 返回错误，可以传msg

​    public Result<T> setResultError(String msg) {

​        return setResult(HTTPStatus.*ERROR*, msg, null);

​    }

​    // 返回成功，可以传data值

​    public Result<T> setResultSuccess(T data) {

​        return setResult(HTTPStatus.*OK*, HTTPStatus.*OK* + "", data);

​    }

​    // 返回成功，沒有data值

​    public Result<T> setResultSuccess() {

​        return setResult(HTTPStatus.*OK*, HTTPStatus.*OK* + "", null);

​    }

​    // 返回成功，沒有data值

​    public Result<T> setResultSuccess(String msg) {

​        return setResult(HTTPStatus.*OK*, msg, null);

​    }

​    // 通用封装

​    public Result<T> setResult(Integer code, String msg, T data) {

​        *log*.info(String.*format*("{code : %s , msg : %s , data : %s}",code,msg, JSONUtil.*toJsonString*(data)));

​        return new Result<T>(code, msg, data);

​    }

}

3.2 service-api工程

3.2.1 xxx-shop-service-api/pom.xml 

3.2.2 在mingrui-shop-service-api项目下新建xxx-shop-service-api-xxx项目

<dependencies>

    <!--帮助开发人员快速生成API文档-->
    
    <dependency>
    
        <groupId>io.springfox</groupId>
    
        <artifactId>springfox-swagger2</artifactId>
    
        <version>2.9.2</version>
    
    </dependency>
    
    <!--提供可视化的API文档-->
    
    <dependency>
    
        <groupId>io.springfox</groupId>
    
        <artifactId>springfox-swagger-ui</artifactId>
    
        <version>2.9.2</version>
    
    </dependency>

</dependencies>

3.2.4 新建包com.baidu.shop.entity 

3.2.5 CategoryEntity

package com.baidu.shop.entity;

import com.baidu.shop.validate.group.MingruiOperation;

import io.swagger.annotations.ApiModel;

import io.swagger.annotations.ApiModelProperty;

import lombok.Data;

import javax.persistence.Id;

import javax.persistence.Table;

import javax.validation.constraints.NotEmpty;

import javax.validation.constraints.NotNull;

*/***

 *** **@ClassName** *CategoryEntity*

 *** **@Description:** *TODO*

 *** **@Author** *shenao*

 *** **@Date** *2020/12/22*

 *** **@Version** *V1.0*

 ***/*

@ApiModel(value = "分类实体类")

@Data

@Table(name = "tb_category")

public class CategoryEntity {

    @Id
    
    @ApiModelProperty(value="分类主键",example = "1")
    
    @NotNull(message="ID不能为空",groups = {MingruiOperation.Update.class})
    
    private Integer id;
    
    @ApiModelProperty(value = "分类名称")
    
    @NotEmpty(message = "分类名称不能为空",groups = {MingruiOperation.Add.class,MingruiOperation.Update.class})
    
    private String name;
    
    @ApiModelProperty(value = "父级分类",example = "1")
    
    @NotNull(message = "父级分类不能为空",groups = {MingruiOperation.Add.class})
    
    private Integer parentId;
    
    @ApiModelProperty(value="是否是父级节点",example = "1")
    
    @NotNull(message = "是否为父级节点不能为空",groups = {MingruiOperation.Add.class})
    
    private Integer isParent;
    
    @ApiModelProperty(value="排序",example = "1")
    
    @NotNull(message = "排序不能为空",groups = {MingruiOperation.Add.class})
    
    private Integer sort;
    
    public Integer getId() {
    
        return id;
    
    }
    
    public void setId(Integer id) {
    
        this.id = id;
    
    }
    
    public String getName() {
    
        return name;
    
    }
3.2.6 swagger2的配置



```
package com.baidu.shop.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import springfox.documentation.builders.ApiInfoBuilder;
import springfox.documentation.builders.PathSelectors;
import springfox.documentation.builders.RequestHandlerSelectors;
import springfox.documentation.service.ApiInfo;
import springfox.documentation.service.Contact;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spring.web.plugins.Docket;
import springfox.documentation.swagger2.annotations.EnableSwagger2;


/**
 * @ClassName MrSwagger2Config
 * @Description: TODO
 * @Author shenao
 * @Date 2020/12/22
 * @Version V1.0
 **/
@Configuration
@EnableSwagger2
public class MrSwagger2Config {
    @Bean
    public Docket createRestApi(){
        return new Docket(DocumentationType.SWAGGER_2)
                .apiInfo(this.apiInfo())
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.baidu"))
                .paths(PathSelectors.any())
                .build();
    }

    private ApiInfo apiInfo(){
        return new ApiInfoBuilder()
                 //标题
                .title("明瑞SWAGGER2标题")
                 //条款地址
                .termsOfServiceUrl("http://www.baidu.com")
                  //联系方式-->有String参数的方法但是已经过时，所以不推荐使用
                .contact(new Contact("shenyaqi","baidu.com","shenyaqiii@163.com"))
                  //版本
                .version("v1.0")
                  //项目描述
                .description("描述")
                 //创建API基本信息
                .build();
    }

}
```

#### 3.3.1商品分类管理(删除)

 TreeItem.vue : line 164

deleteChild: function () {



​    if(this.model.isParent == 1){

​     this.$message.warning('当前节点为父节点');

​     return ;

​    }

​    this.$message.confirm('此操作将永久删除数据，是否继续?', '提示', {

​     confirmButtonText: '确定删除',

​     cancelButtonText: '取消',

​     type: 'warning'

​    }).then(() => {

​     this.handleDelete(this.model.id);

​    }).catch(()=>{

​     this.$message.info('已取消删除');

​    })



   },

Category.vue

handleDelete(id) {

​    this.$http.delete('/category/del?id=' + id).then(resp =>{

​     //this.$message.success('删除成功');

​     //重新加载树形组件

​     if(resp.data.code != 200){

​      this.$message.error('删除失败:' + resp.data.message);

​      return ;

​     }

​     this.$message.success('删除成功');

​     this.delKey = new Date().getTime();//避免key重复

​    }).catch(error => console.log(error))

   },



删除完成后给key重新设置一个值可实现组件刷新

xxx-shop-service-api-xxx

CategoryService

```
@ApiOperation(value="通过id删除分类")
@DeleteMapping(value="/category/del")
Result<JsonObject> delCategory(Integer id);

```

#### 3.4.1商品分类管理(修改)

 3.4.2将TreeItem.vue的afterEdit方法this.model.beginEdit改为 this.beginEdit

afterEdit() {

​    if (this.beginEdit) {

​     this.beginEdit = false;

​     this.handleEdit(this.model.id, this.model.name);

​    }

   },

3.4.3Category.vue

handleEdit(id, name) {

​    console.log("edit... id: " + id + ", name: " + name)

​    this.$http.put('/category/edit',{

​     id:id,

​     name:name,

​    }).then(resp =>{

​     this.$message.success('修改成功');

​     this.delKey = new Date().getTime();//避免key重复

​    }).catch(error => console.log(error))

   },



service层

```
@ApiOperation(value = "修改分类")
@PutMapping(value="/category/edit")
Result<JsonObject> editCategory(@Validated({MingruiOperation.Update.class}) @RequestBody CategoryEntity categoryEntity);
```

实现类

```
@Override
public Result<JsonObject> editCategory(CategoryEntity categoryEntity) {
    try {
        categoryMapper.updateByPrimaryKeySelective(categoryEntity);
    } catch (Exception e) {
        e.printStackTrace();
    }
    return this.setResultSuccess();
}
```

#### 3.5.1商品分类管理(新增)

---Category.vue

handleAdd(node) {

​    console.log("add .... ");

​    console.log(node);

​    //处理boolean值

​    node.isParent = node.isParent?1:0;

​    //删除id属性

​    delete node.id;

​    //新增

​    this.$http.post('/category/add',node).then(resp =>{

​     this.$message.success('新增成功');

​     this.delKey = new Date().getTime();

​    }).catch(error => console.log(error))

   },

service

```
@ApiOperation(value="新增分类")
@PostMapping(value="/category/add")
Result<JsonObject> addCategory(@Validated({MingruiOperation.Add.class})@RequestBody CategoryEntity categoryEntity);
```

实现类

```
@Override
public Result<JsonObject> addCategory(CategoryEntity categoryEntity) {
    categoryMapper.insertSelective(categoryEntity);

    return this.setResultSuccess();
}
```



#### 4.1.1品牌管理（查询）

--在item包下新建MrBrand.vue

<template>

 <v-card>

  <v-card-title>

   <v-btn color="info" @click="addData()">新增</v-btn>



      <div class="text-xs-center">

​    <v-dialog v-model="dialog" width="500">

​     <v-card>

​      <v-card-title class="headline grey lighten-2" primary-title>

​       品牌{{ isEdit?'修改':'新增' }}

​      </v-card-title>



​      <mr-brand-form @closeDialog="closeDialog" :dialog="dialog" :isEdit="isEdit" :brandDetail="brandDetail" />

​     </v-card>

​    </v-dialog>

   </div>



   <!-- 调按钮和输入框之间的间距 -->

   <v-spacer />



   <!--

​      append-icon : 图标

​      label : input默认值

​    -->

   <v-text-field

​    append-icon="search"

​    label="品牌名称"

​    @keyup.enter="getTableData()"

​    v-model="search"

   \></v-text-field>

  </v-card-title>

  <!-- 表格组件 -->

  <v-data-table

   :headers="headers"

   :items="desserts"

   :pagination.sync="pagination"

   :total-items="total"

   class="elevation-1"

  \>

   <template slot="items" slot-scope="props">

​    <td class="text-xs-center">{{ props.item.id }}</td>

​    <td class="text-xs-center">{{ props.item.name }}</td>

​    <td class="text-xs-center">

​     <!-- src 是html标签的属性 :src="vue的属性" -->

          <img width="100" :src="props.item.image" />

​    </td>

​    <td class="text-xs-center">{{ props.item.letter }}</td>

​    <td class="text-xs-center">

​     <v-btn flat icon color="yellow" @click="editData(props.item)">

​      <v-icon>edit</v-icon>

​     </v-btn>

​     <v-btn flat icon color="green" @click="deleteDate(props.item.id)">

​      <v-icon>delete</v-icon>

​     </v-btn>

​    </td>

   </template>

  </v-data-table>

 </v-card>

</template>

<script>

import MrBrandForm from "./MrBrandForm";

export default {

 name: "MrBrand",

 components: {

  MrBrandForm,

 },

 data() {

  return {

   brandDetail:{},

   isEdit:false,

   pagination: {},

   dialog: false,

   total: 0,

   search: "",

   headers: [

​    {

​     text: "id",

​     align: "center",

​     value: "id",

​    },

​    {

​     text: "品牌名称",

​     align: "center",

​     value: "name",

​    },

​    {

​     text: "品牌logo",

​     align: "center",

​     value: "image",

​    },

​    {

​     text: "首字母",

​     align: "center",

​     value: "letter",

​    },

​    {

​     text: "操作",

​     align: "center",

​     sortable: false,

​     value: "id",

​    },

   ],

   desserts: [],

  };

 },

 mounted() {

  this.getTableData();

 },

 methods: {

  closeDialog () {

   this.dialog = false;

   this.getTableData();

  },

  deleteDate(id){

​    this.$message.confirm('此操作将永久删除该品牌, 是否继续?').then(() =>{

​      this.$http.delete('/brand/delete?id=' +id).then((resp)=>{



​       if(resp.data.code != 200){

​        this.$message.error('删除失败');

​       }

​        this.$message.success('删除成功');

​        this.getTableData();



​      }).catch((error)=>{

​       console.log(error);

​      })



​    }).catch(() => {

​     this.$message.info("删除已取消！");

​    })

  },

  addData () {

   //this.brandDetail = {};

   this.isEdit = false;

   this.dialog = true;

  },

  editData (obj) {

   this.brandDetail = obj;

   this.isEdit = true;

   this.dialog = true;

  },

  getTableData() {

   this.$http

​    .get("/brand/getBrandInfo", {

​     params: {

​      page: this.pagination.page,

​      rows: this.pagination.rowsPerPage,

​      sort: this.pagination.sortBy,

​      order: this.pagination.descending,

​      name: this.search,

​     },

​    })

​    .then((resp) => {

​     this.desserts = resp.data.data.list;

​     this.total = resp.data.data.total;

​    })

​    .catch((error) => console.log(error));

  },

 },

 watch: {

  pagination() {

   this.getTableData();

  },

 },

};

</script>



--index.js line : 27

route("/item/brand",'/item/MrBrand',"MrBrand"),

2.2 common-core

2.2.1 pom.xml

```
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>2.9.2</version>
</dependency>
```

在base包下新建BaseDTO

```
package com.baidu.shop.base;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;
import org.springframework.util.StringUtils;


/**
 * @ClassName BaseDTO
 * @Description: TODO
 * @Author shenao
 * @Date 2020/12/25
 * @Version V1.0
 **/
@Data
@ApiModel(value = "BaseDTO用于数据传输,其他dto需要继承此类")
public class BaseDTO {

    @ApiModelProperty(value = "当前页", example = "1")
    private Integer page;

    @ApiModelProperty(value = "每页显示多少条",example = "5")
    private Integer rows;

    @ApiModelProperty(value = "排序字段")
    private String sort;

    @ApiModelProperty(value = "是否升序")
    private String order;

    public String getOrderBy(){
        return sort + " " +(Boolean.valueOf(order) ? "desc":"asc");
    }


}
```

#### 4.2.1品牌管理（新增）

--新建MrBrandForm.vue

<template>

  <div>

  <v-card-text>

   <v-form v-model="valid" ref="form">

​    <v-text-field

​     v-model="brand.name"

​     label="品牌名称"

​     :rules="nameRules"

​     required

​    \></v-text-field>



​    <v-cascader

​     url="/category/list"

​     required

​     v-model="brand.categories"

​     multiple

​     label="商品分类"

​    />



​    <v-layout row>

​     <v-flex xs3>

​      <span style="font-size: 16px; color: #444">品牌LOGO：</span>

​     </v-flex>

​     <v-flex>

​      <v-upload

​       v-model="brand.image"

​       url="/upload"

​       :multiple="false"

​       :pic-width="250"

​       :pic-height="90"

​      />

​     </v-flex>

​    </v-layout>

   </v-form>

  </v-card-text>



  <v-divider></v-divider>



  <v-card-actions>

   <v-spacer></v-spacer>

   <v-btn small @click="cancel()">取消</v-btn>

   <v-btn small color="primary" @click="submitForm()">确认</v-btn>

  </v-card-actions>

 </div>

</template>

<script>

export default {

 name: "MrBrandForm",

 props: {

  dialog: Boolean,

  brandDetail:Object,

  isEdit:Boolean

 },

 watch: {

  dialog(val) {

   if (val) {

​    delete this.brand.id;

​    this.$refs.form.reset();

   }

  },

  brandDetail (val) {

   //控制是新增还是修改发生的数据变化

   if(this.isEdit){

​    //回显数据

​    this.$http.get('/category/brand',{

​     params:{

​      brandId:val.id

​     }

​    }).then(resp => {

​     let brand = val;

​     brand.categories = resp.data.data;

​     this.brand = brand;

​    }).catch(error => console.log(error));



   }

  },

  

 },

 data() {

  //在js中 null == false , '' == false , undefined == false , 0 == false

  return {

   valid: true,

   nameRules: [

​    (v) => !!v || "品牌名称不能为空",

​    (v) => (v && v.length <= 10) || "品牌名称最多10个长度",

   ],

   brand: {

​    name: "",

​    image:'',

​    categories: [],

   },

  };

 },

 methods: {

  cancel() {

   this.$emit("closeDialog");

  },

  submitForm() {

   if (!this.$refs.form.validate()) {

​    return;

   }

   let formData = this.brand;

   let categoryIdArr = this.brand.categories.map((category) => category.id);

   formData.categories = categoryIdArr.join();



   //$.ajax() 和 $.get() | $.post()方法的区别?

   this.$http({

​    url:'/brand/addBrandInfo',

​    method:this.isEdit ? 'put' : 'post',

​    data:formData

   }).then((resp) => {

​     if (resp.data.code != 200) {

​      return;

​     }

​     //关闭模态框

​     this.cancel();

​     //刷新表单



​    })

​    .catch((error) => console.log(error));

  },

 },

};

</script>

在utils包下新建BaiduBeanUtil

service层

```
@ApiOperation(value="新增品牌")
@PostMapping(value="brand/addBrandInfo")
public Result<JSONObject> addBrandInfo(@Validated({MingruiOperation.Add.class})@RequestBody BrandDTO brandDTO);
```

```
@Override
public Result<JSONObject> addBrandInfo(BrandDTO brandDTO) {
    //新增返回主键?
    //两种方式实现 select-key insert加两个属性
    BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDTO,BrandEntity.class);
    brandEntity.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandEntity.getName().toCharArray()[0]),false).toCharArray()[0]);
    brandMapper.insertSelective(brandEntity);

    //维护中间表
    String categories = brandDTO.getCategories();//得到分类集合字符串
    if(StringUtils.isEmpty(brandDTO.getCategories())) return this.setResultError("");

    //判断分类集合串中是否包含
    if(categories.contains(",")) {
        categoryBrandMapper.insertList(
                Arrays.asList(categories.split(","))
                .stream()
                .map(categoryIdStr -> new CategoryBrandEntity(Integer.valueOf(categoryIdStr)
                        ,brandEntity.getId()))
                .collect(Collectors.toList())
        );
    }else{
        CategoryBrandEntity categoryBrandEntity = new CategoryBrandEntity();
        categoryBrandEntity.setBrandId(brandEntity.getId());
        categoryBrandEntity.setCategoryId(Integer.valueOf(categories));

        categoryBrandMapper.insert(categoryBrandEntity);
        }
    return this.setResultSuccess();
}
```

4.3 图片上传

图片上传说白了就是文件上传 

有可能每个服务都会有涉及到文件上传的操作 

所以我们把文件上传抽出来作为一个公共的文件上传服务



Upload.vue line:88&89

this.dialogImageUrl = file.response.data;

this.$emit("input", file.response.data)

--

 MrBrandForm.vue

<template>

  <div>

  <v-card-text>

   <v-form v-model="valid" ref="form">

​    <v-text-field

​     v-model="brand.name"

​     label="品牌名称"

​     :rules="nameRules"

​     required

​    \></v-text-field>



​    <v-cascader

​     url="/category/list"

​     required

​     v-model="brand.categories"

​     multiple

​     label="商品分类"

​    />



​    <v-layout row>

​     <v-flex xs3>

​      <span style="font-size: 16px; color: #444">品牌LOGO：</span>

​     </v-flex>

​     <v-flex>

​      <v-upload

​       v-model="brand.image"

​       url="/upload"

​       :multiple="false"

​       :pic-width="250"

​       :pic-height="90"

​      />

​     </v-flex>

​    </v-layout>

   </v-form>

  </v-card-text>



  <v-divider></v-divider>



  <v-card-actions>

   <v-spacer></v-spacer>

   <v-btn small @click="cancel()">取消</v-btn>

   <v-btn small color="primary" @click="submitForm()">确认</v-btn>

  </v-card-actions>

 </div>

</template>

<script>

export default {

 name: "MrBrandForm",

 props: {

  dialog: Boolean,

  brandDetail:Object,

  isEdit:Boolean

 },

 watch: {

  dialog(val) {

   if (val) {

​    delete this.brand.id;

​    this.$refs.form.reset();

   }

  },

  brandDetail (val) {

   //控制是新增还是修改发生的数据变化

   if(this.isEdit){

​    //回显数据

​    this.$http.get('/category/brand',{

​     params:{

​      brandId:val.id

​     }

​    }).then(resp => {

​     let brand = val;

​     brand.categories = resp.data.data;

​     this.brand = brand;

​    }).catch(error => console.log(error));



   }

  },

  

 },

 data() {

  //在js中 null == false , '' == false , undefined == false , 0 == false

  return {

   valid: true,

   nameRules: [

​    (v) => !!v || "品牌名称不能为空",

​    (v) => (v && v.length <= 10) || "品牌名称最多10个长度",

   ],

   brand: {

​    name: "",

​    image:'',

​    categories: [],

   },

  };

 },

 methods: {

  cancel() {

   this.$emit("closeDialog");

  },

  submitForm() {

   if (!this.$refs.form.validate()) {

​    return;

   }

   let formData = this.brand;

   let categoryIdArr = this.brand.categories.map((category) => category.id);

   formData.categories = categoryIdArr.join();



   //$.ajax() 和 $.get() | $.post()方法的区别?

   this.$http({

​    url:'/brand/addBrandInfo',

​    method:this.isEdit ? 'put' : 'post',

​    data:formData

   }).then((resp) => {

​     if (resp.data.code != 200) {

​      return;

​     }

​     //关闭模态框

​     this.cancel();

​     //刷新表单



​    })

​    .catch((error) => console.log(error));

  },

 },

};

</script>

#### 4.3.1品牌管理(修改)

<template>

 <v-card>

  <v-card-title>

   <v-btn color="info" @click="addData()">新增</v-btn>



      <div class="text-xs-center">

​    <v-dialog v-model="dialog" width="500">

​     <v-card>

​      <v-card-title class="headline grey lighten-2" primary-title>

​       品牌{{ isEdit?'修改':'新增' }}

​      </v-card-title>



​      <mr-brand-form @closeDialog="closeDialog" :dialog="dialog" :isEdit="isEdit" :brandDetail="brandDetail" />

​     </v-card>

​    </v-dialog>

   </div>



   <!-- 调按钮和输入框之间的间距 -->

   <v-spacer />



   <!--

​      append-icon : 图标

​      label : input默认值

​    -->

   <v-text-field

​    append-icon="search"

​    label="品牌名称"

​    @keyup.enter="getTableData()"

​    v-model="search"

   \></v-text-field>

  </v-card-title>

  <!-- 表格组件 -->

  <v-data-table

   :headers="headers"

   :items="desserts"

   :pagination.sync="pagination"

   :total-items="total"

   class="elevation-1"

  \>

   <template slot="items" slot-scope="props">

​    <td class="text-xs-center">{{ props.item.id }}</td>

​    <td class="text-xs-center">{{ props.item.name }}</td>

​    <td class="text-xs-center">

​     <!-- src 是html标签的属性 :src="vue的属性" -->

          <img width="100" :src="props.item.image" />

​    </td>

​    <td class="text-xs-center">{{ props.item.letter }}</td>

​    <td class="text-xs-center">

​     <v-btn flat icon color="yellow" @click="editData(props.item)">

​      <v-icon>edit</v-icon>

​     </v-btn>

​     <v-btn flat icon color="green" @click="deleteDate(props.item.id)">

​      <v-icon>delete</v-icon>

​     </v-btn>

​    </td>

   </template>

  </v-data-table>

 </v-card>

</template>

<script>

import MrBrandForm from "./MrBrandForm";

export default {

 name: "MrBrand",

 components: {

  MrBrandForm,

 },

 data() {

  return {

   brandDetail:{},

   isEdit:false,

   pagination: {},

   dialog: false,

   total: 0,

   search: "",

   headers: [

​    {

​     text: "id",

​     align: "center",

​     value: "id",

​    },

​    {

​     text: "品牌名称",

​     align: "center",

​     value: "name",

​    },

​    {

​     text: "品牌logo",

​     align: "center",

​     value: "image",

​    },

​    {

​     text: "首字母",

​     align: "center",

​     value: "letter",

​    },

​    {

​     text: "操作",

​     align: "center",

​     sortable: false,

​     value: "id",

​    },

   ],

   desserts: [],

  };

 },

 mounted() {

  this.getTableData();

 },

 methods: {

  closeDialog () {

   this.dialog = false;

   this.getTableData();

  },

  deleteDate(id){

​    this.$message.confirm('此操作将永久删除该品牌, 是否继续?').then(() =>{

​      this.$http.delete('/brand/delete?id=' +id).then((resp)=>{



​       if(resp.data.code != 200){

​        this.$message.error('删除失败');

​       }

​        this.$message.success('删除成功');

​        this.getTableData();



​      }).catch((error)=>{

​       console.log(error);

​      })



​    }).catch(() => {

​     this.$message.info("删除已取消！");

​    })

  },

  addData () {

   //this.brandDetail = {};

   this.isEdit = false;

   this.dialog = true;

  },

  editData (obj) {

   this.brandDetail = obj;

   this.isEdit = true;

   this.dialog = true;

  },

  getTableData() {

   this.$http

​    .get("/brand/getBrandInfo", {

​     params: {

​      page: this.pagination.page,

​      rows: this.pagination.rowsPerPage,

​      sort: this.pagination.sortBy,

​      order: this.pagination.descending,

​      name: this.search,

​     },

​    })

​    .then((resp) => {

​     this.desserts = resp.data.data.list;

​     this.total = resp.data.data.total;

​    })

​    .catch((error) => console.log(error));

  },

 },

 watch: {

  pagination() {

   this.getTableData();

  },

 },

};

</script>

service层

```
@ApiOperation(value="通过品牌id查询分类信息")
@GetMapping(value="category/brand")
Result<List<CategoryEntity>> getCategoryByBrandId(Integer brandId);
```

实现类

```
@Override
public Result<List<CategoryEntity>> getCategoryByBrandId(Integer brandId) {
    List<CategoryEntity> byBrandId = categoryMapper.getCategoryByBrandId(brandId);
    return this.setResultSuccess(byBrandId);
}
```

#### 4.4.1品牌管理(删除)

service层

```
@ApiOperation(value = "通过id删除品牌信息")
@DeleteMapping(value="brand/delete")
Result<JSONObject> deleteBrand(Integer id);
```

实现类

```
@Override
public Result<JSONObject> deleteBrand(Integer id) {
    brandMapper.deleteByPrimaryKey(id);
    this.deleteCategoryBrandByBrandId(id);
    return this.setResultSuccess();
}
```

#### 5.5.1 商品规格参数管理(查询)

 加载分类信息

 index.js line:29

route("/item/specification",'/item/specification/Specification',"Specification"),

----specification/Specification.vue

<!--修改成我们自己的url-->

<v-tree url="/category/list" :isEdit="false" @handleClick="handleClick" />

规格组(查询)

 SpecGroup.vue

loadData() {

   this.$http

​    .get("/specgroup/getSpecGroupInfo", {

​     params: {

​      cid: this.cid,

​     },

​    })

​    .then((resp) => {

​     this.groups = resp.data.data;

​    })

​    .catch(() => {

​     this.groups = [];

​    });

  },

service

```
@ApiOperation(value="通过条件查询规格组")
@GetMapping(value = "specgroup/getSpecGroupInfo")
Result<List<SpecGroupEntity>> getSpecGroupInfo(SpecGroupDTO specGroupDTO);
```

实现类

```
@Override
public Result<List<SpecGroupEntity>> getSpecGroupInfo(SpecGroupDTO specGroupDTO) {
    //通过分类id查询数据
    Example example = new Example(SpecGroupEntity.class);
    if(ObjectUtil.isNotNull(specGroupDTO.getCid()))
        example.createCriteria().andEqualTo("cid",specGroupDTO.getCid());

    List<SpecGroupEntity> list = specGroupMapper.selectByExample(example);
    return this.setResultSuccess(list);
}
```

#### 5.6.1 规格组(新增,删除,修改)

SpecGroup.vue

save() {

   this.$http({

​    method: this.isEdit ? "put" : "post",

​    url: "/specgroup/save",

​    data: this.group,

   })

​    .then((resp) => {

​     // 关闭窗口

​     if (resp.data.code == 200) {

​      this.show = false;

​      this.$message.success("保存成功！");

​      this.loadData();

​     } else {

​      this.$message.error(resp.data.msg);

​     }

​    })

​    .catch(() => {

​     this.$message.error("保存失败！");

​    });

  },

deleteGroup(id) {

   this.$message.confirm("确认要删除分组吗？").then(() => {

​    this.$http.delete("/specgroup/delete?id=" + id).then((resp) => {

​     if (resp.data.code == 200) {

​      this.$message.success("删除成功");

​      this.loadData();

​     } else {

​      this.$message.error(resp.data.msg);

​     }

​    });

   });

  },



service

```
@ApiOperation(value = "新增规格组")
@PostMapping(value="specgroup/save")
Result<JSONObject> addGroupInfo(@RequestBody SpecGroupDTO specGroupDTO);

@ApiOperation(value = "新增规格组")
@PutMapping(value="specgroup/save")
Result<JSONObject> editGroupInfo(@RequestBody SpecGroupDTO specGroupDTO);

@ApiOperation(value = "删除规格组")
@DeleteMapping(value="specgroup/delete{id}")
Result<JSONObject> deleteSpecGroupById(@PathVariable Integer id);
```

实现类

```
@Override
public Result<JSONObject> addGroupInfo(SpecGroupDTO specGroupDTO) {
    specGroupMapper.insertSelective(BaiduBeanUtil.copyProperties(specGroupDTO,SpecGroupEntity.class));
    return this.setResultSuccess();
}

@Transactional
@Override
public Result<JSONObject> editGroupInfo(SpecGroupDTO specGroupDTO) {
    specGroupMapper.updateByPrimaryKeySelective(BaiduBeanUtil.copyProperties(specGroupDTO,SpecGroupEntity.class));
    return this.setResultSuccess();
}

@Transactional
@Override
public Result<JSONObject> deleteSpecGroupById(Integer id) {

    Example example = new Example(SpecParamEntity.class);
    example.createCriteria().andEqualTo("groupId",id);

    List<SpecParamEntity> specParamEntities = specParamMapper.selectByExample(example);
    if(specParamEntities.size() >= 1) return this.setResultError("下面有参数,不能删除");

    specGroupMapper.deleteByPrimaryKey(id);
    return this.setResultSuccess();
}
```

#### 6.1.1规格参数(查询)

SpecParam.vue

loadData() {

   this.$http

​    .get("/specparam/getSpecParamInfo",{

​     params:{

​      groupId:this.group.id

​     }

​    })

​    .then((resp) => {

​     resp.data.data.forEach(p => {

​       p.segments = p.segments ? p.segments.split(",").map(s => s.split("-")) : [];

​     })

​     this.params = resp.data.data;

​    })

​    .catch(() => {

​     this.params = [];

​    });

  },

service

```
@ApiOperation(value="查询规格参数")
@GetMapping(value="specparam/getSpecParamInfo")
Result<List<SpecParamEntity>> getSpecParamInfo(SpecParamDTO specParamDTO);
```

实现类

```
@Override
public Result<List<SpecParamEntity>> getSpecParamInfo(SpecParamDTO specParamDTO) {
    SpecParamEntity specParamEntity = BaiduBeanUtil.copyProperties(specParamDTO, SpecParamEntity.class);
    Example example = new Example(SpecParamEntity.class);
    example.createCriteria().andEqualTo("groupId",specParamEntity.getGroupId());

    List<SpecParamEntity> specParamEntities = specParamMapper.selectByExample(example);
    return this.setResultSuccess(specParamEntities);
}
```

#### 6.2.1 规格参数(增,删,改)

SpecParam.vue

editParam(param) {

​    this.param = param;

​    this.isEdit = true;

​    this.show = true;

  },

  addParam() {

   this.param = {

​     cid: this.group.cid,

​     groupId: this.group.id,

​     segments:[],

​     numeric:false,

​     searching:false,

​     generic:false}

   this.show = true;

  },

  deleteParam(id) {

​    this.$message.confirm("确认要删除该参数吗？")

​    .then(() => {

​      this.$http.delete("/specparam/delete?id=" + id)

​      .then(() => {

​        this.$message.success("删除成功");

​        this.loadData();

​      })

​      .catch(() => {

​        this.$message.error("删除失败");

​      })

​    })

  },

service

service

```
@ApiOperation(value = "新增规格参数")
@PostMapping(value="specparam/save")
Result<JSONObject> addParam(@RequestBody SpecParamDTO specParamDTO);

@ApiOperation(value = "修改规格参数")
@PutMapping(value="specparam/save")
Result<JSONObject> editParam(@RequestBody SpecParamDTO specParamDTO);

@ApiOperation(value = "删除规格参数")
@DeleteMapping(value="specparam/delete")
Result<JSONObject> deleteParam(Integer id);
```

实现类

```
@Override
public Result<JSONObject> addParam(SpecParamDTO specParamDTO) {
    specParamMapper.insertSelective(BaiduBeanUtil.copyProperties(specParamDTO,SpecParamEntity.class));
    return this.setResultSuccess();
}

@Override
public Result<JSONObject> editParam(SpecParamDTO specParamDTO) {
    specParamMapper.updateByPrimaryKeySelective(BaiduBeanUtil.copyProperties(specParamDTO,SpecParamEntity.class));
    return this.setResultSuccess();
}

@Override
public Result<JSONObject> deleteParam(Integer id) {

    specParamMapper.deleteByPrimaryKey(id);
    return this.setResultSuccess();
}
```

#### java上传文件到fastDFS服务

pom.xml

```
<dependency>
    <groupId>com.github.tobato</groupId>
    <artifactId>fastdfs-client</artifactId>
    <version>1.26.1-RELEASE</version>
</dependency>
```

config包下新建配置类FastClientImporter

```
package com.baidu.config;

import com.github.tobato.fastdfs.FdfsClientConfig;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.EnableMBeanExport;
import org.springframework.context.annotation.Import;
import org.springframework.jmx.support.RegistrationPolicy;

/**
 * @ClassName FastClientImporter
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/5
 * @Version V1.0
 **/
@Configuration
@Import(FdfsClientConfig.class)
@EnableMBeanExport(registration = RegistrationPolicy.IGNORE_EXISTING)
public class FastClientImporter {
}
```

上传文件controller

```
package com.baidu.shop.upload.controller;

import com.baidu.shop.base.Result;
import com.baidu.shop.status.HTTPStatus;
import com.github.tobato.fastdfs.domain.StorePath;
import com.github.tobato.fastdfs.domain.ThumbImageConfig;
import com.github.tobato.fastdfs.service.FastFileStorageClient;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import java.io.IOException;
import java.io.InputStream;

/**
 * @ClassName FastDFSUploadController
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/5
 * @Version V1.0
 **/
@RestController
@RequestMapping(value="upload")
@Slf4j
public class FastDFSUploadController {

    @Value(value = "{mingrui.upload.img.host}")
    private String imgHost;

    @Autowired
    private FastFileStorageClient storageClient;

    @Autowired
    private ThumbImageConfig thumbImageConfig;

    @PostMapping
    public Result<String> uploadImg(@RequestParam MultipartFile file) throws IOException{
        InputStream inputStream = file.getInputStream();
        String fileName = file.getOriginalFilename();
        String ex = fileName.substring(fileName.lastIndexOf(".") + 1);
        StorePath storePath = this.storageClient.uploadImageAndCrtThumbImage(
                inputStream, file.getSize(), ex, null);//上传
        // 带分组的路径
        log.info("上传图片全路径:{}", storePath.getFullPath());
        // 不带分组的路径
        log.info("上传图片路径:{}", storePath.getPath());
        // 获取缩略图路径
        String path = thumbImageConfig.getThumbImagePath(storePath.getFullPath());
        log.info("缩略图路径:{}", path);
        return new Result<String>(HTTPStatus.OK,"上传成功",imgHost + path);
    }
}
```

#### 7.1商品列表(查询)

Goods.vue

line:8

<v-btn-toggle mandatory v-model="search.saleable">

​     <v-btn flat :value="2">

​      全部

​     </v-btn>

​     <v-btn flat :value="1">

​      上架

​     </v-btn>

​     <v-btn flat :value="0">

​      下架

​     </v-btn>

​    </v-btn-toggle>

line:204

getDataFromApi() {

​    this.loading = true;

​    this.$http.get('/goods/getSpuInfo',{

​     params: {

​      page: this.pagination.page,

​      rows: this.pagination.rowsPerPage,

​      sort: this.pagination.sortBy,

​      order: this.pagination.descending,

​      saleable:this.search.saleable,

​      title: this.search.key

​     },

​    }).then(resp => {

​     this.items = resp.data.data.list;

​     this.totalItems = resp.data.data.total;

​     this.loading = false;

​    }).catch(error => console.log(error))

​    

   }

service

```
@ApiOperation(value = "查询spu信息")
@GetMapping(value = "/goods/getSpuInfo")
Result<PageInfo<SpuEntity>> getSpuInfo(SpuDTO spuDTO);
```

实现类

```
@Override
public Result<PageInfo<SpuEntity>> getSpuInfo(SpuDTO spuDTO) {
    if(ObjectUtil.isNotNull(spuDTO.getPage()) && ObjectUtil.isNotNull(spuDTO.getRows()))
        PageHelper.startPage(spuDTO.getPage(),spuDTO.getRows());
    Example example = new Example(SpuEntity.class);
    Example.Criteria criteria = example.createCriteria();

    if(ObjectUtil.isNotNull(spuDTO.getSaleable()) && spuDTO.getSaleable() < 2)
        criteria.andEqualTo("saleable",spuDTO.getSaleable());

    if(!StringUtils.isEmpty(spuDTO.getTitle()))
        criteria.andLike("title","%" + spuDTO.getTitle() + "%");

    List<SpuEntity> spuEntities = spuMapper.selectByExample(example);
    PageInfo<SpuEntity> spuEntityPageInfo = new PageInfo<>(spuEntities);

    return this.setResultSuccess(spuEntityPageInfo);
}
```

JSON.stringify

#### 7.2商品列表(新增[数据准备])

 GoodsFrom.vue

line:20

<v-cascader

​         url="/category/list"

​         required

​         showAllLevels

​         v-model="goods.categories"

​         label="请选择商品分类"/>

line:277

handler(val) {

​    console.log(val)

​    // 判断商品分类是否存在，存在才查询

​    if (val && val.length > 0) {

​     // 根据分类查询品牌

​     this.$http

​      .get("/brand/getBrandByCategory",{

​       params:{

​        cid:this.goods.categories[2].id

​       }

​      })

​      .then((resp) => {

​       this.brandOptions = resp.data.data;

​      });

​     // 根据分类查询规格参数

​     this.$http

​      .get("/specparam/getSpecParamInfo",{

​       params:{

​        cid:this.goods.categories[2].id

​       }

​      })

​      .then((resp) => {

​       let specs = [];

​       let template = [];

​       if (this.isEdit){

​        specs = JSON.parse(this.goods.spuDetail.genericSpec);

​        template = JSON.parse(this.goods.spuDetail.specialSpec);

​       }

​       // 对特有规格进行筛选

​       const arr1 = [];

​       const arr2 = [];

​       resp.data.data.forEach(({id, name,generic, numeric, unit }) => {

​        if(generic){

​         const o = { id, name, numeric, unit};

​         if(this.isEdit){

​          o.v = specs[id];

​         }

​         arr1.push(o)

​        }else{

​         const o = {id, name, options:[]};

​         if(this.isEdit){

​          o.options = template[id];

​         }

​         arr2.push(o)

​        }

​       });

​       this.specs = arr1;// 通用规格

​       this.specialSpecs = arr2;// 特有规格

​      });

​    }

   }

line:57

<v-stepper-content step="2">

​    <v-editor v-model="goods.spuDetail.description" upload-url="/upload"/>

   </v-stepper-content>

line:206

images: images ? images.map(image => image.data).join(",") : '',

Editor.vue

line:93

this.$http.post(this.uploadUrl, data)

​     .then(res => {

​      if (res.data.data) {

​       this.editor.insertEmbed(this.editor.getSelection().index, 'image', res.data.data)

​      }

​     })

BrandService

```
@ApiOperation(value = "通过分类id获取品牌")
@GetMapping(value="brand/getBrandByCategory")
public Result<List<BrandEntity>> getBrandByCategory(Integer cid);
```

BrandMapper

```
package com.baidu.shop.mapper;

import com.baidu.shop.entity.BrandEntity;
import org.apache.ibatis.annotations.Select;
import tk.mybatis.mapper.common.Mapper;

import java.util.List;

public interface BrandMapper extends Mapper<BrandEntity> {

    @Select(value = "select * from tb_brand b where b.id in(select cb.brand_id from tb_category_brand cb where cb.category_id=#{cid})")
    List<BrandEntity> getBrandByCategory(Integer cid);
}
```

BrandServiceImpl

```
@Override
public Result<List<BrandEntity>> getBrandByCategory(Integer cid) {
    List<BrandEntity> list = brandMapper.getBrandByCategory(cid);

    return this.setResultSuccess(list);
}
```

SpecificationServiceImpl

```
@Override
public Result<List<SpecParamEntity>> getSpecParamInfo(SpecParamDTO specParamDTO) {
    SpecParamEntity specParamEntity = BaiduBeanUtil.copyProperties(specParamDTO, SpecParamEntity.class);
    Example example = new Example(SpecParamEntity.class);
    Example.Criteria criteria = example.createCriteria();

    if(ObjectUtil.isNotNull(specParamDTO.getGroupId())){
        criteria.andEqualTo("groupId",specParamDTO.getGroupId());
    }

    if(ObjectUtil.isNotNull(specParamDTO.getCid())){
        criteria.andEqualTo("cid",specParamDTO.getCid());
    }
    List<SpecParamEntity> specParamEntities = specParamMapper.selectByExample(example);
    return this.setResultSuccess(specParamEntities);
}
```

#### 商品管理(新增[传值接值])

![Snipaste_2021-01-06_17-27-14](D:\1\month sex\day21\Snipaste_2021-01-06_17-27-14.png)

xxx-shop-service-api-xxx

SpuDetailEntity

```
package com.baidu.shop.entity;

import lombok.Data;

import javax.persistence.Id;
import javax.persistence.Table;

/**
 * @ClassName SpuDetailEntity
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/7
 * @Version V1.0
 **/
@Table(name="tb_spu_detail")
@Data
public class SpuDetailEntity {

    @Id
    private Integer spuId;

    private String description;

    private String genericSpec;

    private String specialSpec;

    private String packingList;

    private String afterService;
}
```

 SkuEntity

```
package com.baidu.shop.entity;

import lombok.Data;

import javax.persistence.Id;
import javax.persistence.Table;
import java.util.Date;

/**
 * @ClassName SkuEntity
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/7
 * @Version V1.0
 **/
@Table(name="tb_sku")
@Data
public class SkuEntity {

    @Id
    private Long id;

    private Integer spuId;

    private String title;

    private String images;

    private Integer price;

    private String indexes;

    private String ownSpec;

    private Integer enable;

    private Date createTime;

    private Date lastUpdateTime;
}
```

 StockEntity

```
package com.baidu.shop.entity;

import lombok.Data;

import javax.persistence.Id;
import javax.persistence.Table;

/**
 * @ClassName StockEntity
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/7
 * @Version V1.0
 **/
@Table(name = "tb_stock")
@Data
public class StockEntity {

    @Id
    private Long skuId;

    private Integer seckillStock;

    private Integer seckillTotal;

    private Integer stock;
}
```

dto包下新建dto

SpuDetailDTO

```
package com.baidu.shop.dto;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

/**
 * @ClassName SpuDetailDTO
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/7
 * @Version V1.0
 **/
@ApiModel(value = "spu大字段数据传输类")
@Data
public class SpuDetailDTO {

    @ApiModelProperty(value = "spu主键",example = "1")
    private Integer spuId;

    @ApiModelProperty(value = "商品描述信息")
    private String description;

    @ApiModelProperty(value = "通用规格参数数据")
    private String genericSpec;

    @ApiModelProperty(value = "特有规格参数及可选值信息,json格式")
    private String specialSpec;

    @ApiModelProperty(value="包装清单")
    private String packingList;

    @ApiModelProperty(value = "售后服务")
    private String afterService;
}
```

SkuDTO

```
package com.baidu.shop.dto;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import java.util.Date;

/**
 * @ClassName SkuDTO
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/7
 * @Version V1.0
 **/
@ApiModel(value = "SKU属性数据传输类")
@Data
public class SkuDTO {

    @ApiModelProperty(value = "主键",example = "1")
    private Long id;

    @ApiModelProperty(value = "spu主键",example = "1")
    private Integer spuId;

    @ApiModelProperty(value = "商品标题")
    private String title;

    @ApiModelProperty(value = "商品的图片,多个图片以','分割")
    private String images;

    @ApiModelProperty(value = "销售价格,单位为分",example = "1")
    private Integer price;

    @ApiModelProperty(value = "特有规格属性在spu属性模板中的对应下标组合")
    private String indexes;

    @ApiModelProperty(value = "sku的特有规格参数键值对，json格式，反序列化时请使用 linkedHashMap，保证有序")
    private String ownSpec;

    @ApiModelProperty(value = "是否有效，0无效，1有效", example = "1")
    private Boolean enable;

    @ApiModelProperty(value = "添加时间")
    private Date createTime;

    @ApiModelProperty(value = "最后修改时间")
    private Date lastUpdateTime;

    @ApiModelProperty(value = "库存")
    private Integer stock;
}
```

StockDTO

```
package com.baidu.shop.dto;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

/**
 * @ClassName StockDTO
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/7
 * @Version V1.0
 **/
@ApiModel(value = "库存数据传输类")
@Data
public class StockDTO {

    @ApiModelProperty(value = "sku主键",example = "1")
    private Long skuId;

    @ApiModelProperty(value = "可秒杀库存",example = "1")
    private Integer seckillStock;

    @ApiModelProperty(value = "秒杀总数量", example = "1")
    private Integer seckillTotal;

    @ApiModelProperty(value = "库存数量", example = "1")
    private Integer stock;
}
```

修改SpuDTO

```
package com.baidu.shop.dto;

import com.baidu.shop.base.BaseDTO;
import com.baidu.shop.validate.group.MingruiOperation;
import io.swagger.annotations.ApiModelProperty;
import io.swagger.annotations.ApiOperation;
import lombok.Data;

import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;
import java.util.Date;
import java.util.List;

/**
 * @ClassName SpuDTO
 * @Description: TODO
 * @Author shenao
 * @Date 2021/1/5
 * @Version V1.0
 **/
@ApiOperation(value = "spu数据传输DTO")
@Data
public class SpuDTO extends BaseDTO {

    @ApiModelProperty(value="主键",example = "1")
    @NotNull(message = "主键不能为空",groups = {MingruiOperation.Update.class})
    private Integer id;

    @ApiModelProperty(value = "标题")
    @NotEmpty(message = "标题不能为空", groups = {MingruiOperation.Add.class})
    private String title;

    @ApiModelProperty(value = "子标题")
    private String subTitle;

    @ApiModelProperty(value = "1级类目id", example = "1")
    @NotNull(message = "1级类目id不能为空",groups = {MingruiOperation.Add.class})
    private Integer cid1;

    @ApiModelProperty(value = "2级类目id", example = "1")
    @NotNull(message = "2级类目id不能为空",groups = {MingruiOperation.Add.class})
    private Integer cid2;

    @ApiModelProperty(value = "3级类目id", example = "1")
    @NotNull(message = "3级类目id不能为空",groups = {MingruiOperation.Add.class})
    private Integer cid3;

    @ApiModelProperty(value = "商品所属品牌id", example = "1")
    @NotNull(message = "商品所属品牌id不能为空",groups = {MingruiOperation.Add.class})
    private Integer brandId;

    //不需要验证,新增时直接设置默认值
    @ApiModelProperty(value = "是否上架，0下架，1上架", example = "1")
    private Integer saleable;

    //不需要验证,新增时直接设置默认值
    @ApiModelProperty(value = "是否有效，0已删除，1有效", example = "1")
    private Integer valid;

    //不需要验证,新增时直接设置默认值
    @ApiModelProperty(value = "添加时间")
    private Date createTime;

    //不需要验证,新增时直接设置默认值,修改时使用java代码赋值
    @ApiModelProperty(value = "最后修改时间")
    private Date lastUpdateTime;

    private String brandName;

    private String categoryName;

    @ApiModelProperty(value = "大字段数据")
    private SpuDetailDTO spuDetail;

    @ApiModelProperty(value = "sku属性数据集合")
    private List<SkuDTO> skus;

}
```

GoodsService

```
@ApiOperation(value = "新建商品")
@PostMapping(value = "/goods/add")
Result<JSONObject> saveGoods(@RequestBody SpuDTO spuDTO);
```

vue项目

GoodsForm.vue line:277

this.$emit("closeForm");

xxx-shop-service-xxx

mapper包下新建mapper

 SpuDetailMapper

```
package com.baidu.shop.mapper;

import com.baidu.shop.entity.SpuDetailEntity;
import tk.mybatis.mapper.common.Mapper;

public interface SpuDetailMapper extends Mapper<SpuDetailEntity> {
}
```

SkuMapper

```
package com.baidu.shop.mapper;

import com.baidu.shop.dto.SkuDTO;
import com.baidu.shop.entity.SkuEntity;
import org.apache.ibatis.annotations.Select;
import tk.mybatis.mapper.additional.idlist.DeleteByIdListMapper;
import tk.mybatis.mapper.common.Mapper;
import tk.mybatis.mapper.common.special.InsertListMapper;

import java.util.List;

public interface SkuMapper extends Mapper<SkuEntity>, InsertListMapper<SkuEntity>, DeleteByIdListMapper<SkuEntity,Long> {
    @Select(value = "select k.*,t.stock from tb_sku k, tb_stock t where k.id = t.sku_id and k.spu_id = #{spuId}")
    List<SkuDTO> getSkusAndStockBySpuId(Integer spuId);
}
```

StockMapper

```
package com.baidu.shop.mapper;

import com.baidu.shop.entity.StockEntity;
import tk.mybatis.mapper.additional.idlist.DeleteByIdListMapper;
import tk.mybatis.mapper.common.Mapper;

public interface StockMapper extends Mapper<StockEntity>, DeleteByIdListMapper<StockEntity,Long> {
}
```

GoodsServiceImpl

```
@Resource
private CategoryMapper categoryMapper;
@Resource
private SpuDetailMapper spuDetailMapper;
@Resource
private SkuMapper skuMapper;
@Resource
private StockMapper stockMapper;
```

```
@Override
public Result<JSONObject> saveGoods(SpuDTO spuDTO) {
    final Date date = new Date();
    SpuEntity spuEntity = BaiduBeanUtil.copyProperties(spuDTO, SpuEntity.class);
    spuEntity.setSaleable(1);
    spuEntity.setValid(1);
    spuEntity.setCreateTime(date);
    spuEntity.setLastUpdateTime(date);
    spuMapper.insertSelective(spuEntity);

    SpuDetailDTO spuDetailDTO = spuDTO.getSpuDetail();
    SpuDetailEntity spuDetailEntity = BaiduBeanUtil.copyProperties(spuDTO.getSpuDetail(),SpuDetailEntity.class);
    spuDetailEntity.setSpuId(spuEntity.getId());
    spuDetailMapper.insertSelective(spuDetailEntity);

    //新增sku
    this.saveSkusAndStockInfo(spuDTO,spuEntity.getId(),date);

    return this.setResultSuccess();
}
private void saveSkusAndStockInfo(SpuDTO spuDTO,Integer spuId,Date date){
        List<SkuDTO> skus = spuDTO.getSkus();
        skus.stream().forEach(skuDTO -> {

            SkuEntity skuEntity = BaiduBeanUtil.copyProperties(skuDTO, SkuEntity.class);
            skuEntity.setSpuId(spuId);
            skuEntity.setCreateTime(date);
            skuEntity.setLastUpdateTime(date);
            skuMapper.insertSelective(skuEntity);

            //新增stock
            StockEntity stockEntity = new StockEntity();
            stockEntity.setSkuId(skuEntity.getId());
            stockEntity.setStock(skuDTO.getStock());
            stockMapper.insertSelective(stockEntity);
        });
    }
```

####  7.3修改(回显数据)



######  Goods.vue



editItem(item) {

​    //this.selectedGoods = item;



​    // const names = item.categoryName.split("/");

​    // this.selectedGoods.categories = [

​    //  {id: item.cid1, name: names[0]},

​    //  {id: item.cid2, name: names[1]},

​    //  {id: item.cid3, name: names[2]}

​    // ];

​    // 查询商品详情

​    //保证isEdit状态为true

​    this.isEdit = true;

​    this.show = true;



​    //只监控一次oldGoods

​    let obj = item;

​    this.$http.get("/goods/getSpuDetailBySpuId",{

​     params:{

​      spuId:item.id

​     }

​    }).then(resp => {

​     obj.categories = [];//解决监控到的值为undefined

​     obj.spuDetail = resp.data.data;

​     obj.spuDetail.specTemplate = JSON.parse(resp.data.data.specialSpec);//特有规格参数

​     obj.spuDetail.specifications = JSON.parse(resp.data.data.genericSpec);//通用规格参数



​      // this.selectedGoods.spuDetail = resp.data.data;

​      // this.selectedGoods.spuDetail.specTemplate = JSON.parse(resp.data.data.specialSpec);//特有规格参数

​      // this.selectedGoods.spuDetail.specifications = JSON.parse(resp.data.data.genericSpec);//通用规格参数

​      //通过spuId查询skus

​      this.$http.get('/goods/getSkusBySpuId',{

​       params:{

​        spuId:item.id

​       }

​      }).then(resp => {

​       obj.skus = resp.data.data;

​       this.selectedGoods = obj;

​      }).catch(error => console.log(error));



​    })

​    

   },

###### *GoodsForm.vue*

Goods: {

   deep: true,

   handler(val) {

​    if (!this.isEdit) {

​     Ooldbject.assign(this.goods, {

​      categories: null, // 商品分类信息

​      brandId: 0, // 品牌id信息

​      title: "", // 标题

​      subTitle: "", // 子标题

​      spuDetail: {

​       packingList: "", // 包装列表

​       afterService: "", // 售后服务

​       description: "" // 商品描述

​      }

​     });

​     this.specs = [];

​     this.specialSpecs = [];

​    } else {

​     this.goods = Object.deepCopy(val);



​     // 先得到分类名称 bug!!!!

​     window.setTimeout(() => {

​      const names = val.categoryName.split("/");

​      // 组织商品分类数据

​      this.goods.categories = [

​       { id: val.cid1, name: names[0] },

​       { id: val.cid2, name: names[1] },

​       { id: val.cid3, name: names[2] }

​      ];

​     },50)

//<select>

 // <option>2005</option>

 // <option>2006</option>

 // <option selected>2007</option>

 // <option>2008</option>

//</select>



​     // 将skus处理成map

​     const skuMap = new Map();

​     this.goods.skus.forEach(s => {

​      skuMap.set(s.indexes, s);

​     });

​     this.goods.skus = skuMap;

​    }

   }

  },

  "goods.categories": {

   deep: true,

   handler(val) {

​    console.log(val)

​    // 判断商品分类是否存在，存在才查询

​    if (val && val.length > 0) {

​     // 根据分类查询品牌

​     this.$http

​      .get("/brand/getBrandByCategory",{

​       params:{

​        cid:this.goods.categories[2].id

​       }

​      })

​      .then((resp) => {

​       this.brandOptions = resp.data.data;

​      });

​     // 根据分类查询规格参数

​     this.$http

​      .get("/specparam/getSpecParamInfo",{

​       params:{

​        cid:this.goods.categories[2].id

​       }

​      })

​      .then((resp) => {

​       let specs = [];

​       let template = [];

​       if (this.isEdit){

​        specs = JSON.parse(this.goods.spuDetail.genericSpec);

​        template = JSON.parse(this.goods.spuDetail.specialSpec);

​       }

​       // 对特有规格进行筛选

​       const arr1 = [];

​       const arr2 = [];

​       resp.data.data.forEach(({id, name,generic, numeric, unit }) => {

​        if(generic){

​         const o = { id, name, numeric, unit};

​         if(this.isEdit){

​          o.v = specs[id];

​         }

​         arr1.push(o)

​        }else{

​         const o = {id, name, options:[]};

​         if(this.isEdit){

​          o.options = template[id];

​         }

​         arr2.push(o)

​        }

​       });

​       this.specs = arr1;// 通用规格

​       this.specialSpecs = arr2;// 特有规格

​      });

​    }

   }

  }

 },

GoodsService

```
@ApiOperation(value = "获取spu详情信息")
@GetMapping(value = "goods/getSpuDetailBySpuId")
public Result<SpuDetailEntity> getSpuDetailBySpuId(Integer spuId);

@ApiOperation(value = "获取sku信息")
@GetMapping(value = "goods/getSkusBySpuId")
Result<List<SkuDTO>> getSkuBySpuId(Integer spuId);
```

GoodsServiceImpl

```
@Override
public Result<SpuDetailEntity> getSpuDetailBySpuId(Integer spuId) {
    SpuDetailEntity spuDetailEntity = spuDetailMapper.selectByPrimaryKey(spuId);
    return this.setResultSuccess(spuDetailEntity);
}

@Override
public Result<List<SkuDTO>> getSkuBySpuId(Integer spuId) {
    List<SkuDTO> list = skuMapper.getSkusAndStockBySpuId(spuId);
    return this.setResultSuccess(list);
}
```

 修改(后台)

GoodsService

```
@ApiOperation(value = "修改商品")
@PutMapping(value = "/goods/add")
Result<JSONObject> editGoods(@RequestBody SpuDTO spuDTO);
```

GoodsServiceImpl

```
@Transactional
@Override
public Result<JSONObject> editGoods(SpuDTO spuDTO) {
    final Date date = new Date();
    SpuEntity spuEntity = BaiduBeanUtil.copyProperties(spuDTO,SpuEntity.class);
    spuEntity.setLastUpdateTime(date);
    spuMapper.updateByPrimaryKeySelective(spuEntity);

    //修改spuDetail
    spuDetailMapper.updateByPrimaryKeySelective(BaiduBeanUtil.copyProperties(spuDTO.getSpuDetail(),SpuDetailEntity.class));

    //通过spuId查询sku信息
    this.deleteSkusAndStock(spuEntity.getId());

    this.saveSkusAndStockInfo(spuDTO,spuEntity.getId(),date);
    return this.setResultSuccess();
}

private void deleteSkusAndStock(Integer spuId){
    Example example = new Example(SkuEntity.class);
    example.createCriteria().andEqualTo("spuId",spuId);
    List<SkuEntity> skuEntities = skuMapper.selectByExample(example);
    //得到skuId集合
    List<Long> skuIdList = skuEntities.stream().map(skuEntity -> skuEntity.getId()).collect(Collectors.toList());
    skuMapper.deleteByIdList(skuIdList);//通过skuId集合删除sku信息
    stockMapper.deleteByIdList(skuIdList);//通过skuId集合删除stock信息
}

private void saveSkusAndStockInfo(SpuDTO spuDTO,Integer spuId,Date date){
    List<SkuDTO> skus = spuDTO.getSkus();
    skus.stream().forEach(skuDTO -> {

        SkuEntity skuEntity = BaiduBeanUtil.copyProperties(skuDTO, SkuEntity.class);
        skuEntity.setSpuId(spuId);
        skuEntity.setCreateTime(date);
        skuEntity.setLastUpdateTime(date);
        skuMapper.insertSelective(skuEntity);

        //新增stock
        StockEntity stockEntity = new StockEntity();
        stockEntity.setSkuId(skuEntity.getId());
        stockEntity.setStock(skuDTO.getStock());
        stockMapper.insertSelective(stockEntity);
    });
}
```

##### 